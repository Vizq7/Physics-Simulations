<!DOCTYPE html>
<html>

<head>
    <script src="https://cdn.jsdelivr.net/npm/p5@1.0.0/lib/p5.js"></script>
    <script src="sketch.js"></script>
</head>

<body style="margin: 30px; padding: 0px;">
    <main>
        <h1>Wave simulation</h1>
        <p><span style="font-family: Arial, Helvetica, sans-serif;">This simulation shows the movement of wave&#39;s inside a tank filled with a fluid.</span></p>
        <div id="sketchContainer" style="text-align: center;"><br></div>
        <p><br></p>
        <h2>The maths behind it</h2>
        <p><span style="font-family: Arial, Helvetica, sans-serif;">For that purpose is needed to solve the wave equation, which is a&nbsp;</span><a href="https://en.wikipedia.org/wiki/Partial_differential_equation" rel="noopener noreferrer" target="_blank"><span style="font-family: Arial, Helvetica, sans-serif;">partial differential equation</span></a><span style="font-family: Arial, Helvetica, sans-serif;">&nbsp;(PDE):</span><br><br></p>
        <p style="text-align: center;">&nbsp;<img src="https://latex.codecogs.com/gif.latex?\large&space;\frac{\partial^2h}{\partial&space;t^2}=c^2\frac{\partial^2&space;h}{\partial&space;x^2}"></p>
        <p style="text-align: left;"><span style="font-family: Arial, Helvetica, sans-serif;">To solve the PDE first a discretization method is applied to approximate the partial derivative terms, in this case the methods used are <a href="https://en.wikipedia.org/wiki/Finite_difference_method" rel="noopener noreferrer" target="_blank">finite differences</a> (implicit) and <a href="https://en.wikipedia.org/wiki/Crank%E2%80%93Nicolson_method" rel="noopener noreferrer" target="_blank">Crank-Nicolson</a>. The equations are:</span></p>
        <p style="text-align: left;"><br></p>
        <p style="text-align: left;"><strong><span style="font-family: Arial, Helvetica, sans-serif;"><u>Finite differences</u></span></strong></p>
        <p style="text-align: center;"><img src="https://latex.codecogs.com/gif.latex?\large&space;\frac{h^{m+1}_j-2h^m_j+h^{m-1}_j}{\Delta&space;t^2}=c^2\frac{h^{m+1}_{j+1}-2h^{m+1}_j+h^{m+1}_{j-1}}{\Delta&space;x^2}"></p>
        <p style="text-align: left;"><span style="font-family: Arial, Helvetica, sans-serif;">If we define</span></p>
        <p style="text-align: center;"><img src="https://latex.codecogs.com/gif.latex?\large&space;\mu=c^2\frac{\Delta&space;t^2}{\Delta&space;x^2}"><br><br></p>
        <p style="text-align: left;"><span style="font-family: Arial, Helvetica, sans-serif;">we can rearrange the equation as a system of linear equations:</span><br><br></p>
        <p style="text-align: center;"><img src="https://latex.codecogs.com/gif.latex?\large&space;-\mu&space;h^{m+1}_{j+1}+(1+2\mu)h^{m+1}_j-\mu&space;h^{m+1}_{j-1}=2h^m_j-h^{m-1}_j"><br><br></p>
        <p style="text-align: left;"><span style="font-family: Arial, Helvetica, sans-serif;">This system of equations can be also expressed as a matrix-vector multiplication:</span><br><br></p>
        <p style="text-align: center;"><img src="https://latex.codecogs.com/png.latex?\LARGE&space;\begin{align*}&space;\begin{bmatrix}&space;1+\mu&space;&&-\mu&space;&&0&space;&&0&space;&&\cdots&space;&&space;\\&space;-\mu&space;&&1+2\mu&space;&&-\mu&space;&&0&space;&&\cdots&space;&&space;\\&space;0&space;&&-\mu&space;&&1+2\mu&space;&&-\mu&space;&&\cdots&space;&&&&&space;\\&space;\vdots&space;&&\vdots&space;&&\ddots&space;&&\ddots&space;&&\ddots&space;&&\vdots&space;&&\vdots&space;\\&space;&&space;&&&space;&\cdots&space;&&-\mu&space;&&1+2\mu&space;&&-\mu&space;&&0&space;\\&space;&&space;&&&space;&\cdots&space;&&0&space;&&-\mu&space;&&1+2\mu&space;&&&space;-\mu&space;\\&space;&&space;&&&space;&\cdots&space;&&0&space;&&0&space;&&-\mu&space;&&1+2\mu&space;\end{bmatrix}&space;\begin{bmatrix}&space;h^{m+1}_0&space;\\h^{m+1}_1&space;\\h^{m+1}_2&space;\\\vdots&space;\\h^{m+1}_{N-3}&space;\\h^{m+1}_{N-2}&space;\\h^{m+1}_{N-1}&space;\end{bmatrix}&=&space;\begin{bmatrix}&space;2h^m_0-h^{m-1}_0&space;\\2h^m_1-h^{m-1}_1&space;\\2h^m_2-h^{m-1}_2&space;\\\vdots&space;\\2h^m_{N-3}-h^{m-1}_{N-3}&space;\\2h^m_{N-2}-h^{m-1}_{N-2}&space;\\2h^m_{N-1}-h^{m-1}_{N-1}&space;\end{bmatrix}\\&space;\end{align*}"><br><br></p>
        <p style="text-align: left;"><strong><span style="font-family: Arial, Helvetica, sans-serif;"><u>Crank-Nicolson</u></span></strong></p>
        <p style="text-align: center;"><img src="https://latex.codecogs.com/png.latex?\large&space;\frac{h^{m+1}_j-2h^m_j+h^{m-1}_j}{\Delta&space;t^2}=\frac{c^2}{2}\frac{h^m_{j+1}-2h^m_j+h^m_{j-1}}{\Delta&space;x^2}+\frac{c^2}{2}\frac{h^{m+1}_{j+1}-2h^{m+1}_j+h^{m+1}_{j-1}}{\Delta&space;x^2}"></p>
        <p style="text-align: left;"><span style="font-family: Arial, Helvetica, sans-serif;">If we define</span></p>
        <p style="text-align: center;"><img src="https://latex.codecogs.com/png.latex?\large&space;\mu=c^2\frac{\Delta&space;t^2}{2\Delta&space;x^2}"></p>
        <p style="text-align: left;"><br><span style="font-family: Arial, Helvetica, sans-serif;">we can as well rearrange the equation as a system of linear equations:</span><br><br></p>
        <p style="text-align: center;"><span style="font-family: Arial, Helvetica, sans-serif;"><img src="https://latex.codecogs.com/png.latex?\large&space;\begin{align*}&space;-\mu&space;h^{m+1}_{j+1}+(1+2\mu)h^{m+1}_j-\mu&space;h^{m+1}_{j-1}&=\mu&space;h^m_{j+1}+2(1-\mu)h^m_j+\mu&space;h^m_{j-1}-h^{m-1}_j&space;\end{align*}"></span></p>
        <p style="text-align: left;"><span style="font-family: Arial, Helvetica, sans-serif;">thus we have the matrix-vector multiplication:</span><br><br></p>
        <p style="text-align: center;"><img src="https://latex.codecogs.com/png.latex?\LARGE&space;\begin{align*}&space;\begin{bmatrix}&space;1+\mu&space;&&-\mu&space;&&0&space;&&0&space;&&\cdots&space;&&space;\\&space;-\mu&space;&&1+2\mu&space;&&-\mu&space;&&0&space;&&\cdots&space;&&space;\\&space;0&space;&&-\mu&space;&&1+2\mu&space;&&-\mu&space;&&\cdots&space;&&&&&space;\\&space;\vdots&space;&&\vdots&space;&&\ddots&space;&&\ddots&space;&&\ddots&space;&&\vdots&space;&&\vdots&space;\\&space;&&space;&&&space;&\cdots&space;&&-\mu&space;&&1+2\mu&space;&&-\mu&space;&&0&space;\\&space;&&space;&&&space;&\cdots&space;&&0&space;&&-\mu&space;&&1+2\mu&space;&&&space;-\mu&space;\\&space;&&space;&&&space;&\cdots&space;&&0&space;&&0&space;&&-\mu&space;&&1+2\mu&space;\end{bmatrix}&space;\begin{bmatrix}&space;h^{m+1}_0&space;\\h^{m+1}_1&space;\\h^{m+1}_2&space;\\\vdots&space;\\h^{m+1}_{N-3}&space;\\h^{m+1}_{N-2}&space;\\h^{m+1}_{N-1}&space;\end{bmatrix}&=&space;\begin{bmatrix}&space;\mu&space;h^m_0+2(1-\mu)h^m_0+\mu&space;h^m_1-h^{m-1}_0&space;\\\mu&space;h^m_0+2(1-\mu)h^m_1+\mu&space;h^m_2-h^{m-1}_1&space;\\\mu&space;h^m_1+2(1-\mu)h^m_2+\mu&space;h^m_3-h^{m-1}_2&space;\\\vdots&space;\\\mu&space;h^m_{N-4}+2(1-\mu)h^m_{N-3}+\mu&space;h^m_{N-2}-h^{m-1}_{N-3}&space;\\\mu&space;h^m_{N-3}+2(1-\mu)h^m_{N-2}+\mu&space;h^m_{N-1}-h^{m-1}_{N-2}&space;\\\mu&space;h^m_{N-2}+2(1-\mu)h^m_{N-1}+\mu&space;h^m_{N-1}-h^{m-1}_{N-1}&space;\end{bmatrix}\\&space;\end{align*}"></p>
        <p><br></p>
        <p><span style="font-family: Arial, Helvetica, sans-serif;">Where in all of these equations the &quot;j&quot; and &quot;m&quot; represent the index of position and time respectively and &quot;h&quot; the value of height in these indexes.</span></p>
        <p><span style="font-family: Arial, Helvetica, sans-serif;">We can see that if we are at j = 0 (the initial position) there is a term that needs the value at j = -1, obviously this position does not exist. For that reason <a href="https://en.wikipedia.org/wiki/Neumann_boundary_condition" rel="noopener noreferrer" target="_blank">Neumann boundary condition</a> is used, this means that we do not compute the height at positions j = 0 and j = N, instead we copy the next value that can be calculated in these boundary positions.</span></p>
        <p><span style="font-family: Arial, Helvetica, sans-serif;"><br></span></p>
        <p style="text-align: left;"><span style="font-family: Arial, Helvetica, sans-serif;">Now that we have the linear system of equations two iterative solvers are used for the computation of the next time step, i.e, for getting the height of the wave at the next time instant in a position &quot;j&quot;. These solvers are the <a href="https://en.wikipedia.org/wiki/Jacobi_method" rel="noopener noreferrer" target="_blank">Jacobi method</a> and <a href="https://en.wikipedia.org/wiki/Gauss%E2%80%93Seidel_method" rel="noopener noreferrer" target="_blank">Gauss-Seidel method</a>, which equations, applied to each<span style="font-size: 16px;">&nbsp;<span style="color: rgb(0, 0, 0); font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial; float: none; display: inline !important;">discretization,</span></span><span style="color: rgb(0, 0, 0); font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial; float: none; display: inline !important;">&nbsp;</span>are:</span></p>
        <p style="text-align: left;"><br></p>
        <p style="text-align: left;"><strong><span style="font-family: Arial, Helvetica, sans-serif;"><u>Finite differences / Jacobi method</u></span></strong></p>
        <p style="text-align: center;"><img src="https://latex.codecogs.com/png.latex?\large&space;h^{m+1,(n+1)}_j=\frac{(2h^m_j-h^{m-1}_j)+\mu&space;(h^{m+1,(n)}_{j+1}+h^{m+1,(n)}_{j-1})}{(1+2\mu)}"></p>
        <p style="text-align: left;"><strong><span style="font-family: Arial, Helvetica, sans-serif;"><u>Finite differences / Gauss-Seidel method</u></span></strong></p>
        <p style="text-align: center;"><img src="https://latex.codecogs.com/png.latex?\large&space;h^{m+1,(n+1)}_j=\frac{(2h^m_j-h^{m-1}_j)+\mu&space;(h^{m+1,(n)}_{j+1}+h^{m+1,(n+1)}_{j-1})}{(1+2\mu)}"></p>
        <p style="text-align: center;"><br></p>
        <p style="text-align: left;"><strong><span style="font-family: Arial, Helvetica, sans-serif;"><u>Crank-Nicolson / Jacobi method</u></span></strong></p>
        <p style="text-align: center;"><img src="https://latex.codecogs.com/png.latex?\large&space;h^{m+1,(n+1)}_j=\frac{(\mu&space;h^m_{j+1}+2(1-\mu)h^m_j+\mu&space;h^m_{j-1}-h^{m-1}_j)+\mu(h^{m+1,(n)}_{j+1}+h^{m+1,(n)}_{j-1})}{(1+2\mu)}"></p>
        <p style="text-align: left;"><strong><span style="font-family: Arial, Helvetica, sans-serif;"><u>Crank-Nicolson / Gauss-Seidel method</u></span></strong></p>
        <p style="text-align: center;"><span style="font-family: 'Times New Roman', Times, serif;"><img src="https://latex.codecogs.com/png.latex?\large&space;h^{m+1,(n+1)}_j=\frac{(\mu&space;h^m_{j+1}+2(1-\mu)h^m_j+\mu&space;h^m_{j-1}-h^{m-1}_j)+\mu(h^{m+1,(n)}_{j+1}+h^{m+1,(n+1)}_{j-1})}{(1+2\mu)}"></span></p>
        <p style="text-align: left;"><span style="font-family: Arial, Helvetica, sans-serif;">In all of these equations the &quot;n&quot; represent the index of the step in the solver.</span></p>
        <p style="text-align: left;"><span style="font-family: Arial, Helvetica, sans-serif;"><br></span></p>
        <p style="text-align: left;"><span style="font-family: Arial, Helvetica, sans-serif;">The initial height&#39;s (when t = 0) for each position inside the tank are computed using the <a href="https://en.wikipedia.org/wiki/Perlin_noise" rel="noopener noreferrer" target="_blank">Perling noise</a> function.</span></p>
    </main>
</body>

</html>